<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vortex Owner Dashboard</title>
  <link rel="stylesheet" href="owner-dashboard.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="logo-container">
        <img src="https://i.postimg.cc/ZRQYcx0d/Fitness-Club-1-removebg-preview.png" alt="Vortex Logo" class="logo-image" />
        <h1>Owner Dashboard</h1>
      </div>
      <nav class="header-actions">
        <a class="pill-link" href="dashboard.html">Staff Portal</a>
        <a class="pill-link" href="../Suppliment/index.html">Supplements Site</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="filters-card">
      <div class="filters-left">
        <button class="filter-btn active" data-range="today">Today</button>
        <button class="filter-btn" data-range="7d">Last 7 days</button>
        <button class="filter-btn" data-range="30d">Last 30 days</button>
        <button class="filter-btn" data-range="custom">Custom</button>
        <input id="date-range-picker" class="date-input" placeholder="Select date range" />
      </div>
      <div class="filters-right">
        <button id="export-cafe" class="btn-secondary">Export Café CSV</button>
        <button id="export-supp" class="btn-secondary">Export Supplements CSV</button>
      </div>
    </section>

    <section class="summary-grid">
      <div class="summary-card">
        <div class="summary-icon bg-cyan"><i data-lucide="banknote"></i></div>
        <div>
          <p class="summary-label">Total Revenue</p>
          <p id="total-revenue" class="summary-value">৳0.00</p>
        </div>
      </div>
      <div class="summary-card">
        <div class="summary-icon bg-green"><i data-lucide="check-circle-2"></i></div>
        <div>
          <p class="summary-label">Total Orders</p>
          <p id="total-orders" class="summary-value">0</p>
        </div>
      </div>
      <div class="summary-card">
        <div class="summary-icon bg-amber"><i data-lucide="trending-up"></i></div>
        <div>
          <p class="summary-label">Net Profit (Rev - Exp)</p>
          <p id="net-profit" class="summary-value">৳0.00</p>
        </div>
      </div>
      <div class="summary-card">
        <div class="summary-icon bg-red"><i data-lucide="alert-triangle"></i></div>
        <div>
          <p class="summary-label">Low Stock Items</p>
          <p id="low-stock-count" class="summary-value">0</p>
        </div>
      </div>
    </section>

    <div id="loading" class="loading visible">
      <div class="spinner"></div>
      <p>Loading dashboard data…</p>
    </div>

    <div id="analytics-content" class="hidden">
      <nav class="tabs-navigation">
        <button class="tab-btn active" data-tab="overview">
          <i data-lucide="layout-dashboard"></i> Overview
        </button>
        <button class="tab-btn" data-tab="cafe-menu">
          <i data-lucide="coffee"></i> Café Menu
        </button>
        <button class="tab-btn" data-tab="supplements">
          <i data-lucide="pill"></i> Supplements
        </button>
        <button class="tab-btn" data-tab="transactions">
          <i data-lucide="receipt"></i> All Transactions
        </button>
        <button class="tab-btn" data-tab="expenses">
          <i data-lucide="wallet"></i> Expenses
        </button>
      </nav>

      <div id="tab-overview" class="tab-content active">
        <div class="split-grid">
          <div class="card">
            <div class="card-header">
              <h2><i data-lucide="coffee"></i> Recent Café Sales</h2>
            </div>
            <div id="cafe-transactions" class="list-col"></div>
          </div>
          <div class="card">
            <div class="card-header">
              <h2><i data-lucide="pill"></i> Recent Supplement Sales</h2>
            </div>
            <div id="supp-transactions" class="list-col"></div>
          </div>
        </div>

        <div class="card" style="margin-top: 20px;">
          <div class="card-header">
            <h2><i data-lucide="alert-circle"></i> Low Stock Alerts</h2>
          </div>
          <ul id="low-stock-list" class="simple-list"></ul>
        </div>
      </div>

      <div id="tab-cafe-menu" class="tab-content">
        <div class="daily-summary">
  <div class="daily-card">
    <h4>Total Café Sales</h4>
    <p class="value" id="cafe-total-sales">৳0.00</p>
  </div>

  <div class="daily-card">
    <h4>Café Profit </h4>
    <p class="value" id="cafe-net-profit">৳0.00</p>
  </div>

  <div class="daily-card">
    <h4>Payment Breakdown</h4>
    <p class="value" id="cafe-avg-order">৳0.00</p>
  </div>
</div>

        <div class="split-grid">
          <div class="card">
            <div class="card-header">
              <h2><i data-lucide="trophy"></i> Most Sold Items</h2>
            </div>
            <div id="cafe-most-sold" class="card-body"></div>
          </div>
          <div class="card">
            <div class="card-header">
              <h2><i data-lucide="trending-down"></i> Least Sold Items</h2>
            </div>
            <div id="cafe-least-sold" class="card-body"></div>
          </div>
        </div>

        <div class="card" style="margin-top: 20px;">
          <div class="card-header">
            <h2><i data-lucide="list"></i> All Café Menu Sales</h2>
          </div>
          <div id="cafe-all-items" class="list-col"></div>
        </div>
      </div>

      <div id="tab-supplements" class="tab-content">
        
        <div class="card" style="margin-bottom: 24px; border: 1px solid var(--primary);">
            <div class="card-header" style="background-color: #eff6ff;">
                <h2 style="color: var(--primary);"><i data-lucide="shopping-cart"></i> Buy Goods / Restock Inventory</h2>
            </div>
            <form id="restock-form" class="expense-form">
                <select id="restock-product-select" required style="grid-column: span 1;">
                    <option value="">Select Product...</option>
                </select>

                <select id="restock-variant-select" class="hidden" style="grid-column: span 1; background-color: #f0f9ff; border-color: #bae6fd;">
                    <option value="">Select Option...</option>
                </select>

                <input id="restock-qty" type="number" min="1" placeholder="Quantity Bought" required />
                <input id="restock-cost" type="number" step="0.01" min="0" placeholder="Total Cost (৳)" required />
                <button class="btn-primary" type="submit">Confirm Purchase</button>
            </form>
            <div class="card-body">
                <p class="tx-sub" style="margin-top:0;">* This will increase stock, update buying price, and automatically add an entry to Expenses.</p>
            </div>
        </div>

       <div class="daily-summary">
  <div class="daily-card">
    <h4>Total Supplement Sales</h4>
    <p class="value" id="supp-total-sales">৳0.00</p>
  </div>

  <div class="daily-card">
    <h4>Supplements Profit</h4>
    <p class="value" id="supp-net-profit">৳0.00</p>
  </div>

  <div class="daily-card">
    <h4>Payment Breakdown</h4>
    <p class="value" id="supp-profit-margin">0%</p>
  </div>
</div>

        <div class="split-grid">
          <div class="card">
            <div class="card-header">
              <h2><i data-lucide="trophy"></i> Top Supplements (Revenue)</h2>
            </div>
            <ul id="top-supp-by-revenue" class="simple-list"></ul>
          </div>
          <div class="card">
            <div class="card-header">
              <h2><i data-lucide="package"></i> Top Supplements (Units)</h2>
            </div>
            <ul id="top-supp-by-units" class="simple-list"></ul>
          </div>
        </div>

        <div class="split-grid">
          <div class="card">
            <div class="card-header">
              <h2><i data-lucide="trending-down"></i> Least Sold Supplements</h2>
            </div>
            <ul id="least-supp-by-units" class="simple-list"></ul>
          </div>
          <div class="card">
            <div class="card-header">
              <h2><i data-lucide="alert-triangle"></i> Low Stock Items</h2>
            </div>
            <ul id="supp-low-stock-list" class="simple-list"></ul>
          </div>
        </div>
      </div>

      <div id="tab-transactions" class="tab-content">
        <div class="daily-summary">
          <div class="daily-card">
            <h4>Total Transactions</h4>
            <p class="value" id="all-tx-count">0</p>
          </div>
          <div class="daily-card">
            <h4>Total Revenue</h4>
            <p class="value" id="all-tx-revenue">৳0.00</p>
          </div>
          <div class="daily-card">
            <h4>Total Expenses</h4>
            <p class="value" id="all-tx-expenses">৳0.00</p>
          </div>
          <div class="daily-card">
            <h4>Net Income</h4>
            <p class="value" id="all-tx-net">৳0.00</p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2><i data-lucide="search"></i> Search & Filter Transactions</h2>
          </div>
          <div class="card-body">
            <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                <input
                type="text"
                id="tx-search"
                class="search-box"
                style="margin-bottom: 0; flex: 1;"
                placeholder="Search by payment type, order ID..."
                />
                <select id="tx-category-filter" class="search-box" style="margin-bottom: 0; width: 200px;">
                    <option value="all">All Categories</option>
                    <option value="Cafe">Café Only</option>
                    <option value="Supplement">Supplement Only</option>
                    <option value="Expense">Expenses Only</option>
                </select>
            </div>
            
            <div class="table-container">
              <table class="transactions-table">
                <thead>
                  <tr>
                    <th>Date & Time</th>
                    <th>Type</th>
                    <th>Details</th>
                    <th>ID/Desc</th>
                    <th>Amount</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="all-transactions-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div id="tab-expenses" class="tab-content">
        <div class="daily-summary">
          <div class="daily-card">
            <h4>Total Expenses</h4>
            <p class="value" id="exp-total">৳0.00</p>
          </div>
          <div class="daily-card">
            <h4>Number of Expenses</h4>
            <p class="value" id="exp-count">0</p>
          </div>
          <div class="daily-card">
            <h4>Average Expense</h4>
            <p class="value" id="exp-avg">৳0.00</p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2><i data-lucide="plus-circle"></i> Add New Expense</h2>
          </div>
          <form id="expense-form" class="expense-form">
            <input id="exp-description" placeholder="Description (e.g. Electricity Bill)" required style="grid-column: span 1;" />
            <input id="exp-amount" type="number" step="0.01" placeholder="Amount" required />
            <select id="exp-category" required>
                <option value="General">General</option>
                <option value="Cafe">Cafe Expense</option>
                <option value="Supplement">Supplement Expense</option>
            </select>
            <button class="btn-primary" type="submit">Add Expense</button>
          </form>
        </div>

       <div class="card" style="margin-top: 20px;">
          <div class="card-header">
            <h2><i data-lucide="list"></i> Expense History</h2>
          </div>
          
          <div class="card-body" style="padding-bottom: 10px; border-bottom: 1px solid var(--border);">
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <select id="expense-cat-filter" class="search-box" style="margin-bottom: 0; width: 180px;">
                    <option value="all">All Categories</option>
                    <option value="Cafe">Cafe</option>
                    <option value="Supplement">Supplement</option>
                    <option value="General">General</option>
                </select>
                <input 
                    id="expense-search-filter" 
                    class="search-box" 
                    placeholder="Search by description or date..." 
                    style="margin-bottom: 0; flex: 1;" 
                />
            </div>
          </div>

          <ul id="expense-list" class="simple-list"></ul>
        </div>

      </div>

      <p id="no-data-msg" class="empty-message hidden">
        No data found for the selected period.
      </p>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="owner-dashboard.js"></script>
</body>
</html>